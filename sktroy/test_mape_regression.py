import numpy as np
import os, sys
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from sktroy.mape_linear_regression import MAPELinearRegression


def test_random():
    N = 20
    X = np.random.randint(10, 80, N).reshape(N, 1)
    y = np.dot(X, np.array([0.8]).reshape(1, 1)).reshape(N) + 5 + 5 * np.random.randn(N)
    y = np.max([y, 5 * np.ones(N)], axis=0)

    import sklearn.linear_model as skl
    lr = skl.LinearRegression()
    lr.fit(X, y)
    lr_results = lr.predict(X)

    regressor = MAPELinearRegression()
    regressor.fit(X, y)
    results = regressor.predict(X)

    print("linear regression")
    print("w", lr.coef_)
    print("b", lr.intercept_)
    print("MAPE", np.sum(np.abs(lr_results-y)/y)/N)
    print("RMSE", np.sqrt(np.dot(lr_results-y, lr_results-y)/N))

    print("min-MAPE")
    print("w", regressor.coef_)
    print("b", regressor.intercept_)
    print("MAPE", np.sum(np.abs(results-y)/y)/N)
    print("RMSE", np.sqrt(np.dot(results-y, results-y)/N))

    print(np.array([y, results, lr_results]))


def test_real():
    X_training1 = {
        (1, 1, 9, 20): [[343], [341], [335], [342], [317], [271], [393], [364], [308], [243], [316], [293], [376]],
        (2, 0, 9, 20): [[298], [312], [289], [330], [166], [401], [260], [283], [305], [360]],
        (1, 0, 18, 40): [[186], [226], [209], [284], [254], [258], [189], [203], [210], [169], [163], [171]],
        (3, 0, 17, 20): [[465], [488], [440], [504], [537], [549], [473], [465], [458], [427], [473], [442]],
        (3, 1, 17, 20): [[389], [374], [338], [465], [435], [417], [342], [317], [346], [375], [399], [337]],
        (3, 1, 8, 40): [[306], [284], [294], [305], [287], [283], [373], [294], [259], [282], [236], [267]],
        (1, 1, 9, 0): [[343], [341], [335], [342], [317], [271], [393], [364], [308], [243], [316], [293], [376]],
        (1, 1, 18, 20): [[440], [390], [408], [449], [371], [427], [404], [407], [326], [345], [357], [400], [384]],
        (1, 1, 8, 0): [[343], [341], [335], [342], [317], [271], [393], [364], [308], [243], [316], [293], [376]],
        (3, 1, 9, 20): [[306], [284], [294], [305], [287], [283], [373], [294], [259], [282], [236], [267]],
        (1, 1, 17, 0): [[440], [390], [408], [449], [371], [427], [404], [407], [326], [345], [357], [400], [384]],
        (3, 0, 8, 40): [[474], [470], [485], [468], [350], [309], [564], [465], [470], [462], [401], [478]],
        (3, 0, 18, 40): [[465], [488], [440], [504], [537], [549], [473], [465], [458], [427], [473], [442]],
        (1, 0, 8, 20): [[145], [128], [138], [143], [120], [101], [168], [182], [103], [103], [101], [129]],
        (1, 1, 18, 0): [[440], [390], [408], [449], [371], [427], [404], [407], [326], [345], [357], [400], [384]],
        (1, 1, 9, 40): [[343], [341], [335], [342], [317], [271], [393], [364], [308], [243], [316], [293], [376]],
        (1, 1, 17, 20): [[440], [390], [408], [449], [371], [427], [404], [407], [326], [345], [357], [400], [384]],
        (3, 0, 9, 40): [[474], [470], [485], [468], [350], [309], [564], [465], [470], [462], [401], [478]],
        (3, 0, 18, 0): [[465], [488], [440], [504], [537], [549], [473], [465], [458], [427], [473], [442]],
        (3, 0, 9, 20): [[474], [470], [485], [468], [350], [309], [564], [465], [470], [462], [401], [478]],
        (1, 0, 18, 20): [[186], [226], [209], [284], [254], [258], [189], [203], [210], [169], [163], [171]],
        (2, 0, 9, 0): [[298], [312], [289], [330], [166], [401], [260], [283], [305], [360]],
        (1, 1, 8, 40): [[343], [341], [335], [342], [317], [271], [393], [364], [308], [243], [316], [293], [376]],
        (3, 0, 17, 0): [[465], [488], [440], [504], [537], [549], [473], [465], [458], [427], [473], [442]],
        (1, 1, 17, 40): [[440], [390], [408], [449], [371], [427], [404], [407], [326], [345], [357], [400], [384]],
        (2, 0, 8, 0): [[298], [312], [289], [330], [166], [401], [260], [283], [305], [360]],
        (3, 0, 8, 0): [[474], [470], [485], [468], [350], [309], [564], [465], [470], [462], [401], [478]],
        (2, 0, 17, 0): [[335], [291], [311], [369], [317], [284], [320], [251], [264], [295]],
        (2, 0, 9, 40): [[298], [312], [289], [330], [166], [401], [260], [283], [305], [360]],
        (3, 0, 9, 0): [[474], [470], [485], [468], [350], [309], [564], [465], [470], [462], [401], [478]],
        (1, 0, 8, 40): [[145], [128], [138], [143], [120], [101], [168], [182], [103], [103], [101], [129]],
        (3, 1, 18, 0): [[389], [374], [338], [465], [435], [417], [342], [317], [346], [375], [399], [337]],
        (2, 0, 17, 20): [[335], [291], [311], [369], [317], [284], [320], [251], [264], [295]],
        (1, 1, 18, 40): [[440], [390], [408], [449], [371], [427], [404], [407], [326], [345], [357], [400], [384]],
        (3, 1, 8, 20): [[306], [284], [294], [305], [287], [283], [373], [294], [259], [282], [236], [267]],
        (2, 0, 8, 20): [[298], [312], [289], [330], [166], [401], [260], [283], [305], [360]],
        (3, 0, 17, 40): [[465], [488], [440], [504], [537], [549], [473], [465], [458], [427], [473], [442]],
        (3, 1, 17, 0): [[389], [374], [338], [465], [435], [417], [342], [317], [346], [375], [399], [337]],
        (3, 1, 18, 40): [[389], [374], [338], [465], [435], [417], [342], [317], [346], [375], [399], [337]],
        (2, 0, 17, 40): [[335], [291], [311], [369], [317], [284], [320], [251], [264], [295]],
        (1, 0, 9, 40): [[145], [128], [138], [143], [120], [101], [168], [182], [103], [103], [101], [129]],
        (2, 0, 18, 0): [[335], [291], [311], [369], [317], [284], [320], [251], [264], [295]],
        (1, 0, 9, 20): [[145], [128], [138], [143], [120], [101], [168], [182], [103], [103], [101], [129]],
        (3, 1, 9, 0): [[306], [284], [294], [305], [287], [283], [373], [294], [259], [282], [236], [267]],
        (2, 0, 8, 40): [[298], [312], [289], [330], [166], [401], [260], [283], [305], [360]],
        (3, 0, 18, 20): [[465], [488], [440], [504], [537], [549], [473], [465], [458], [427], [473], [442]],
        (3, 1, 8, 0): [[306], [284], [294], [305], [287], [283], [373], [294], [259], [282], [236], [267]],
        (1, 0, 17, 20): [[186], [226], [209], [284], [254], [258], [189], [203], [210], [169], [163], [171]],
        (1, 0, 17, 40): [[186], [226], [209], [284], [254], [258], [189], [203], [210], [169], [163], [171]],
        (1, 0, 8, 0): [[145], [128], [138], [143], [120], [101], [168], [182], [103], [103], [101], [129]],
        (3, 1, 18, 20): [[389], [374], [338], [465], [435], [417], [342], [317], [346], [375], [399], [337]],
        (1, 0, 9, 0): [[145], [128], [138], [143], [120], [101], [168], [182], [103], [103], [101], [129]],
        (3, 0, 8, 20): [[474], [470], [485], [468], [350], [309], [564], [465], [470], [462], [401], [478]],
        (1, 0, 18, 0): [[186], [226], [209], [284], [254], [258], [189], [203], [210], [169], [163], [171]],
        (3, 1, 9, 40): [[306], [284], [294], [305], [287], [283], [373], [294], [259], [282], [236], [267]],
        (2, 0, 18, 40): [[335], [291], [311], [369], [317], [284], [320], [251], [264], [295]],
        (1, 0, 17, 0): [[186], [226], [209], [284], [254], [258], [189], [203], [210], [169], [163], [171]],
        (2, 0, 18, 20): [[335], [291], [311], [369], [317], [284], [320], [251], [264], [295]],
        (1, 1, 8, 20): [[343], [341], [335], [342], [317], [271], [393], [364], [308], [243], [316], [293], [376]],
        (3, 1, 17, 40): [[389], [374], [338], [465], [435], [417], [342], [317], [346], [375], [399], [337]]}
    Y_training1 = {
        (1, 1, 9, 20): [[151], [132], [107], [107], [86], [103], [130], [97], [109], [113], [73], [93], [123]],
        (2, 0, 9, 20): [[78], [99], [81], [93], [104], [120], [102], [99], [94], [92]],
        (1, 0, 18, 40): [[18], [20], [24], [32], [54], [31], [29], [12], [25], [20], [23], [23]],
        (3, 0, 17, 20): [[118], [116], [116], [122], [124], [110], [106], [140], [114], [106], [99], [121]],
        (3, 1, 17, 20): [[85], [94], [86], [110], [88], [84], [90], [73], [73], [88], [91], [94]],
        (3, 1, 8, 40): [[161], [149], [136], [154], [107], [120], [150], [144], [131], [142], [105], [138]],
        (1, 1, 9, 0): [[120], [137], [123], [129], [82], [108], [120], [129], [94], [97], [113], [127], [131]],
        (1, 1, 18, 20): [[94], [85], [83], [96], [75], [61], [85], [85], [69], [70], [70], [80], [81]],
        (1, 1, 8, 0): [[123], [100], [106], [110], [95], [98], [125], [118], [95], [97], [96], [117], [111]],
        (3, 1, 9, 20): [[125], [83], [110], [137], [128], [140], [113], [109], [132], [127], [102], [109]],
        (1, 1, 17, 0): [[96], [94], [114], [113], [94], [105], [106], [94], [86], [94], [92], [127], [109]],
        (3, 0, 8, 40): [[138], [154], [120], [172], [127], [110], [170], [189], [156], [145], [145], [135]],
        (3, 0, 18, 40): [[61], [63], [52], [65], [92], [78], [62], [74], [70], [52], [64], [64]],
        (1, 0, 8, 20): [[56], [50], [58], [68], [64], [40], [52], [45], [48], [39], [39], [44]],
        (1, 1, 18, 0): [[67], [74], [81], [93], [78], [69], [74], [76], [80], [77], [84], [56], [53]],
        (1, 1, 9, 40): [[131], [122], [110], [105], [78], [95], [102], [73], [103], [83], [130], [75], [107]],
        (1, 1, 17, 20): [[116], [109], [102], [105], [85], [104], [112], [142], [113], [91], [109], [110], [124]],
        (3, 0, 9, 40): [[148], [144], [130], [101], [134], [110], [117], [123], [133], [120], [97], [114]],
        (3, 0, 18, 0): [[94], [81], [90], [83], [108], [94], [95], [92], [77], [72], [88], [71]],
        (3, 0, 9, 20): [[144], [142], [120], [132], [113], [125], [148], [127], [132], [137], [122], [153]],
        (1, 0, 18, 20): [[27], [29], [21], [45], [35], [38], [22], [18], [26], [28], [29], [28]],
        (2, 0, 9, 0): [[89], [105], [96], [92], [64], [126], [117], [83], [125], [121]],
        (1, 1, 8, 40): [[116], [119], [111], [112], [102], [105], [116], [125], [118], [122], [82], [103], [103]],
        (3, 0, 17, 0): [[110], [126], [118], [131], [167], [119], [120], [138], [115], [99], [113], [110]],
        (1, 1, 17, 40): [[112], [94], [113], [141], [105], [84], [102], [110], [112], [130], [104], [105], [110]],
        (2, 0, 8, 0): [[129], [112], [108], [112], [70], [117], [105], [106], [125], [129]],
        (3, 0, 8, 0): [[161], [145], [135], [164], [114], [115], [180], [188], [139], [137], [136], [153]],
        (2, 0, 17, 0): [[85], [82], [71], [95], [84], [71], [78], [63], [69], [85]],
        (2, 0, 9, 40): [[59], [87], [65], [76], [93], [81], [82], [86], [80], [90]],
        (3, 0, 9, 0): [[174], [144], [139], [151], [117], [92], [136], [150], [145], [148], [128], [141]],
        (1, 0, 8, 40): [[41], [45], [51], [50], [71], [50], [45], [64], [50], [38], [35], [57]],
        (3, 1, 18, 0): [[73], [67], [54], [100], [57], [75], [91], [83], [68], [61], [70], [63]],
        (2, 0, 17, 20): [[72], [86], [76], [92], [77], [67], [70], [60], [83], [65]],
        (1, 1, 18, 40): [[65], [78], [88], [108], [59], [62], [54], [64], [64], [87], [61], [56], [71]],
        (3, 1, 8, 20): [[168], [122], [127], [135], [113], [111], [164], [118], [132], [129], [109], [99]],
        (2, 0, 8, 20): [[122], [111], [110], [106], [75], [130], [99], [93], [114], [120]],
        (3, 0, 17, 40): [[95], [95], [100], [117], [102], [105], [101], [104], [125], [99], [98], [88]],
        (3, 1, 17, 0): [[86], [77], [78], [86], [87], [118], [85], [76], [86], [87], [76], [79]],
        (3, 1, 18, 40): [[77], [68], [99], [96], [66], [71], [70], [83], [59], [81], [73], [72]],
        (2, 0, 17, 40): [[53], [85], [70], [95], [56], [63], [71], [60], [73], [55]],
        (1, 0, 9, 40): [[44], [59], [59], [44], [66], [49], [51], [45], [48], [38], [41], [53]],
        (2, 0, 18, 0): [[55], [77], [83], [80], [71], [63], [70], [46], [70], [59]],
        (1, 0, 9, 20): [[49], [68], [52], [52], [68], [42], [52], [65], [40], [31], [41], [44]],
        (3, 1, 9, 0): [[145], [131], [116], [134], [115], [108], [145], [117], [143], [132], [109], [120]],
        (2, 0, 8, 40): [[98], [112], [101], [118], [90], [121], [114], [83], [113], [117]],
        (3, 0, 18, 20): [[56], [100], [72], [86], [108], [85], [88], [72], [66], [66], [62], [79]],
        (3, 1, 8, 0): [[118], [126], [121], [118], [122], [112], [138], [96], [110], [128], [112], [124]],
        (1, 0, 17, 20): [[34], [42], [36], [38], [55], [49], [42], [77], [30], [23], [28], [22]],
        (1, 0, 17, 40): [[24], [38], [33], [46], [32], [42], [30], [45], [30], [26], [32], [16]],
        (1, 0, 8, 0): [[46], [53], [50], [49], [43], [35], [49], [60], [41], [31], [46], [47]],
        (3, 1, 18, 20): [[78], [75], [53], [95], [77], [88], [55], [81], [56], [71], [80], [64]],
        (1, 0, 9, 0): [[50], [51], [43], [41], [52], [41], [48], [58], [47], [35], [45], [51]],
        (3, 0, 8, 20): [[167], [173], [163], [160], [121], [88], [172], [137], [148], [152], [156], [150]],
        (1, 0, 18, 0): [[29], [26], [26], [40], [42], [56], [33], [30], [22], [20], [20], [20]],
        (3, 1, 9, 40): [[116], [78], [96], [96], [124], [102], [104], [94], [84], [101], [82], [95]],
        (2, 0, 18, 40): [[49], [56], [53], [80], [41], [48], [58], [37], [54], [41]],
        (1, 0, 17, 0): [[36], [38], [29], [45], [73], [63], [47], [52], [30], [37], [33], [41]],
        (2, 0, 18, 20): [[50], [60], [63], [71], [66], [52], [67], [54], [48], [53]],
        (1, 1, 8, 20): [[119], [105], [98], [127], [101], [96], [91], [116], [105], [102], [117], [121], [114]],
        (3, 1, 17, 40): [[91], [95], [78], [121], [87], [82], [82], [82], [76], [89], [93], [117]]}
    X_validation1 = {(1, 1, 9, 20): [[315], [332], [357], [327], [255], [183], [429]],
                     (2, 0, 9, 20): [[358], [347], [409], [338], [201], [380]],
                     (1, 0, 18, 40): [[178], [183], [175], [266], [244], [281], [196]],
                     (3, 0, 17, 20): [[453], [439], [515], [559], [513], [513], [430]],
                     (3, 1, 17, 20): [[358], [332], [446], [416], [380], [510], [365]],
                     (3, 1, 8, 40): [[270], [292], [288], [275], [261], [192], [351]],
                     (1, 1, 9, 0): [[315], [332], [357], [327], [255], [183], [429]],
                     (1, 1, 18, 20): [[361], [418], [382], [460], [370], [450], [402]],
                     (1, 1, 8, 0): [[315], [332], [357], [327], [255], [183], [429]],
                     (3, 1, 9, 20): [[270], [292], [288], [275], [261], [192], [351]],
                     (1, 1, 17, 0): [[361], [418], [382], [460], [370], [450], [402]],
                     (3, 0, 8, 40): [[466], [450], [461], [449], [382], [279], [567]],
                     (3, 0, 18, 40): [[453], [439], [515], [559], [513], [513], [430]],
                     (1, 0, 8, 20): [[140], [112], [157], [101], [169], [110], [164]],
                     (1, 1, 18, 0): [[361], [418], [382], [460], [370], [450], [402]],
                     (1, 1, 9, 40): [[315], [332], [357], [327], [255], [183], [429]],
                     (1, 1, 17, 20): [[361], [418], [382], [460], [370], [450], [402]],
                     (3, 0, 9, 40): [[466], [450], [461], [449], [382], [279], [567]],
                     (3, 0, 18, 0): [[453], [439], [515], [559], [513], [513], [430]],
                     (3, 0, 9, 20): [[466], [450], [461], [449], [382], [279], [567]],
                     (1, 0, 18, 20): [[178], [183], [175], [266], [244], [281], [196]],
                     (2, 0, 9, 0): [[358], [347], [409], [338], [201], [380]],
                     (1, 1, 8, 40): [[315], [332], [357], [327], [255], [183], [429]],
                     (3, 0, 17, 0): [[453], [439], [515], [559], [513], [513], [430]],
                     (1, 1, 17, 40): [[361], [418], [382], [460], [370], [450], [402]],
                     (2, 0, 8, 0): [[358], [347], [409], [338], [201], [380]],
                     (3, 0, 8, 0): [[466], [450], [461], [449], [382], [279], [567]],
                     (2, 0, 17, 0): [[295], [291], [306], [377], [322], [308]],
                     (2, 0, 9, 40): [[358], [347], [409], [338], [201], [380]],
                     (3, 0, 9, 0): [[466], [450], [461], [449], [382], [279], [567]],
                     (1, 0, 8, 40): [[140], [112], [157], [101], [169], [110], [164]],
                     (3, 1, 18, 0): [[358], [332], [446], [416], [380], [510], [365]],
                     (2, 0, 17, 20): [[295], [291], [306], [377], [322], [308]],
                     (1, 1, 18, 40): [[361], [418], [382], [460], [370], [450], [402]],
                     (3, 1, 8, 20): [[270], [292], [288], [275], [261], [192], [351]],
                     (2, 0, 8, 20): [[358], [347], [409], [338], [201], [380]],
                     (3, 0, 17, 40): [[453], [439], [515], [559], [513], [513], [430]],
                     (3, 1, 17, 0): [[358], [332], [446], [416], [380], [510], [365]],
                     (3, 1, 18, 40): [[358], [332], [446], [416], [380], [510], [365]],
                     (2, 0, 17, 40): [[295], [291], [306], [377], [322], [308]],
                     (1, 0, 9, 40): [[140], [112], [157], [101], [169], [110], [164]],
                     (2, 0, 18, 0): [[295], [291], [306], [377], [322], [308]],
                     (1, 0, 9, 20): [[140], [112], [157], [101], [169], [110], [164]],
                     (3, 1, 9, 0): [[270], [292], [288], [275], [261], [192], [351]],
                     (2, 0, 8, 40): [[358], [347], [409], [338], [201], [380]],
                     (3, 0, 18, 20): [[453], [439], [515], [559], [513], [513], [430]],
                     (3, 1, 8, 0): [[270], [292], [288], [275], [261], [192], [351]],
                     (1, 0, 17, 20): [[178], [183], [175], [266], [244], [281], [196]],
                     (1, 0, 17, 40): [[178], [183], [175], [266], [244], [281], [196]],
                     (1, 0, 8, 0): [[140], [112], [157], [101], [169], [110], [164]],
                     (3, 1, 18, 20): [[358], [332], [446], [416], [380], [510], [365]],
                     (1, 0, 9, 0): [[140], [112], [157], [101], [169], [110], [164]],
                     (3, 0, 8, 20): [[466], [450], [461], [449], [382], [279], [567]],
                     (1, 0, 18, 0): [[178], [183], [175], [266], [244], [281], [196]],
                     (3, 1, 9, 40): [[270], [292], [288], [275], [261], [192], [351]],
                     (2, 0, 18, 40): [[295], [291], [306], [377], [322], [308]],
                     (1, 0, 17, 0): [[178], [183], [175], [266], [244], [281], [196]],
                     (2, 0, 18, 20): [[295], [291], [306], [377], [322], [308]],
                     (1, 1, 8, 20): [[315], [332], [357], [327], [255], [183], [429]],
                     (3, 1, 17, 40): [[358], [332], [446], [416], [380], [510], [365]]}
    Y_validation1 = {(1, 1, 9, 20): [[108], [116], [98], [111], [103], [108], [120]],
                     (2, 0, 9, 20): [[92], [108], [101], [117], [107], [102]],
                     (1, 0, 18, 40): [[25], [21], [23], [43], [29], [38], [14]],
                     (3, 0, 17, 20): [[118], [139], [123], [122], [127], [116], [132]],
                     (3, 1, 17, 20): [[89], [88], [96], [107], [87], [108], [82]],
                     (3, 1, 8, 40): [[129], [137], [131], [127], [121], [86], [150]],
                     (1, 1, 9, 0): [[129], [122], [122], [126], [110], [100], [161]],
                     (1, 1, 18, 20): [[83], [82], [73], [85], [71], [77], [84]],
                     (1, 1, 8, 0): [[130], [114], [107], [108], [73], [47], [132]],
                     (3, 1, 9, 20): [[115], [114], [118], [100], [97], [90], [137]],
                     (1, 1, 17, 0): [[75], [89], [114], [122], [85], [98], [112]],
                     (3, 0, 8, 40): [[172], [160], [148], [146], [128], [102], [180]],
                     (3, 0, 18, 40): [[60], [50], [64], [57], [62], [80], [65]],
                     (1, 0, 8, 20): [[49], [54], [59], [59], [47], [44], [46]],
                     (1, 1, 18, 0): [[66], [48], [53], [89], [67], [76], [52]],
                     (1, 1, 9, 40): [[123], [100], [114], [152], [121], [108], [121]],
                     (1, 1, 17, 20): [[93], [132], [94], [132], [94], [134], [126]],
                     (3, 0, 9, 40): [[122], [112], [131], [129], [121], [72], [117]],
                     (3, 0, 18, 0): [[105], [89], [89], [74], [82], [105], [90]],
                     (3, 0, 9, 20): [[122], [107], [140], [140], [115], [94], [150]],
                     (1, 0, 18, 20): [[33], [25], [33], [30], [30], [41], [24]],
                     (2, 0, 9, 0): [[106], [112], [127], [105], [95], [114]],
                     (1, 1, 8, 40): [[126], [109], [130], [108], [123], [67], [141]],
                     (3, 0, 17, 0): [[114], [111], [114], [146], [105], [132], [140]],
                     (1, 1, 17, 40): [[109], [129], [120], [135], [90], [111], [130]],
                     (2, 0, 8, 0): [[122], [129], [112], [112], [81], [130]],
                     (3, 0, 8, 0): [[168], [151], [162], [158], [105], [85], [175]],
                     (2, 0, 17, 0): [[95], [81], [77], [83], [82], [86]],
                     (2, 0, 9, 40): [[71], [86], [77], [77], [87], [91]],
                     (3, 0, 9, 0): [[141], [146], [148], [161], [127], [105], [138]],
                     (1, 0, 8, 40): [[40], [55], [42], [46], [55], [35], [56]],
                     (3, 1, 18, 0): [[78], [88], [87], [125], [92], [88], [79]],
                     (2, 0, 17, 20): [[66], [82], [80], [98], [65], [83]],
                     (1, 1, 18, 40): [[62], [66], [76], [84], [61], [56], [49]],
                     (3, 1, 8, 20): [[111], [114], [115], [134], [80], [80], [147]],
                     (2, 0, 8, 20): [[106], [124], [121], [132], [92], [133]],
                     (3, 0, 17, 40): [[111], [99], [113], [112], [104], [120], [113]],
                     (3, 1, 17, 0): [[98], [99], [88], [112], [104], [100], [80]],
                     (3, 1, 18, 40): [[75], [99], [75], [38], [82], [82], [80]],
                     (2, 0, 17, 40): [[76], [76], [80], [79], [74], [58]],
                     (1, 0, 9, 40): [[44], [34], [59], [45], [55], [48], [41]],
                     (2, 0, 18, 0): [[54], [66], [73], [71], [46], [56]],
                     (1, 0, 9, 20): [[47], [51], [46], [48], [72], [47], [54]],
                     (3, 1, 9, 0): [[118], [109], [112], [125], [90], [107], [136]],
                     (2, 0, 8, 40): [[123], [114], [121], [141], [99], [109]],
                     (3, 0, 18, 20): [[72], [91], [70], [68], [70], [93], [93]],
                     (3, 1, 8, 0): [[116], [99], [119], [99], [80], [85], [123]],
                     (1, 0, 17, 20): [[30], [26], [45], [47], [55], [59], [34]],
                     (1, 0, 17, 40): [[24], [26], [39], [39], [32], [37], [25]],
                     (1, 0, 8, 0): [[49], [45], [51], [34], [44], [29], [50]],
                     (3, 1, 18, 20): [[76], [59], [80], [67], [85], [109], [86]],
                     (1, 0, 9, 0): [[45], [44], [65], [44], [70], [51], [43]],
                     (3, 0, 8, 20): [[136], [146], [157], [180], [97], [114], [182]],
                     (1, 0, 18, 0): [[27], [29], [34], [35], [33], [39], [22]],
                     (3, 1, 9, 40): [[92], [107], [94], [105], [105], [98], [106]],
                     (2, 0, 18, 40): [[50], [55], [52], [69], [32], [53]],
                     (1, 0, 17, 0): [[39], [42], [54], [44], [66], [70], [43]],
                     (2, 0, 18, 20): [[56], [66], [70], [89], [54], [53]],
                     (1, 1, 8, 20): [[108], [111], [114], [107], [103], [72], [140]],
                     (3, 1, 17, 40): [[118], [90], [105], [128], [87], [100], [84]]}
    X_validation2 = {(1, 1, 9, 20): [[339], [325], [325], [308], [223], [185], [377]],
                     (2, 0, 9, 20): [[313], [328], [319], [272], [171], [131], [390]],
                     (3, 1, 17, 0): [[342], [325], [338], [370], [350], [379], [333]],
                     (3, 0, 17, 20): [[450], [404], [482], [629], [445], [487], [450]],
                     (3, 1, 17, 20): [[342], [325], [338], [370], [350], [379], [333]],
                     (3, 1, 8, 40): [[274], [263], [248], [251], [171], [173], [335]],
                     (1, 1, 9, 0): [[339], [325], [325], [308], [223], [185], [377]],
                     (1, 1, 18, 20): [[415], [339], [402], [452], [385], [439], [413]],
                     (1, 1, 8, 0): [[339], [325], [325], [308], [223], [185], [377]],
                     (3, 1, 9, 20): [[274], [263], [248], [251], [171], [173], [335]],
                     (1, 1, 17, 0): [[415], [339], [402], [452], [385], [439], [413]],
                     (3, 0, 8, 40): [[494], [483], [430], [472], [293], [231], [574]],
                     (3, 0, 18, 40): [[450], [404], [482], [629], [445], [487], [450]],
                     (1, 0, 8, 20): [[127], [118], [115], [132], [97], [79], [136]],
                     (1, 1, 18, 0): [[415], [339], [402], [452], [385], [439], [413]],
                     (1, 1, 9, 40): [[339], [325], [325], [308], [223], [185], [377]],
                     (1, 1, 17, 20): [[415], [339], [402], [452], [385], [439], [413]],
                     (3, 0, 9, 40): [[494], [483], [430], [472], [293], [231], [574]],
                     (3, 0, 18, 0): [[450], [404], [482], [629], [445], [487], [450]],
                     (3, 0, 9, 20): [[494], [483], [430], [472], [293], [231], [574]],
                     (1, 0, 18, 20): [[190], [165], [161], [247], [209], [241], [169]],
                     (2, 0, 9, 0): [[313], [328], [319], [272], [171], [131], [390]],
                     (1, 1, 8, 40): [[339], [325], [325], [308], [223], [185], [377]],
                     (3, 0, 17, 0): [[450], [404], [482], [629], [445], [487], [450]],
                     (1, 1, 17, 40): [[415], [339], [402], [452], [385], [439], [413]],
                     (2, 0, 8, 0): [[313], [328], [319], [272], [171], [131], [390]],
                     (3, 0, 8, 0): [[494], [483], [430], [472], [293], [231], [574]],
                     (2, 0, 17, 0): [[261], [238], [278], [347], [277], [268], [295]],
                     (2, 0, 9, 40): [[313], [328], [319], [272], [171], [131], [390]],
                     (3, 0, 9, 0): [[494], [483], [430], [472], [293], [231], [574]],
                     (1, 0, 8, 40): [[127], [118], [115], [132], [97], [79], [136]],
                     (2, 0, 17, 20): [[261], [238], [278], [347], [277], [268], [295]],
                     (1, 1, 18, 40): [[415], [339], [402], [452], [385], [439], [413]],
                     (3, 1, 8, 20): [[274], [263], [248], [251], [171], [173], [335]],
                     (3, 1, 18, 0): [[342], [325], [338], [370], [350], [379], [333]],
                     (1, 0, 17, 40): [[190], [165], [161], [247], [209], [241], [169]],
                     (3, 0, 17, 40): [[450], [404], [482], [629], [445], [487], [450]],
                     (1, 0, 18, 40): [[190], [165], [161], [247], [209], [241], [169]],
                     (3, 1, 18, 40): [[342], [325], [338], [370], [350], [379], [333]],
                     (2, 0, 17, 40): [[261], [238], [278], [347], [277], [268], [295]],
                     (1, 0, 9, 40): [[127], [118], [115], [132], [97], [79], [136]],
                     (2, 0, 18, 0): [[261], [238], [278], [347], [277], [268], [295]],
                     (1, 0, 9, 20): [[127], [118], [115], [132], [97], [79], [136]],
                     (3, 1, 9, 0): [[274], [263], [248], [251], [171], [173], [335]],
                     (2, 0, 8, 40): [[313], [328], [319], [272], [171], [131], [390]],
                     (3, 0, 18, 20): [[450], [404], [482], [629], [445], [487], [450]],
                     (3, 1, 8, 0): [[274], [263], [248], [251], [171], [173], [335]],
                     (1, 0, 17, 20): [[190], [165], [161], [247], [209], [241], [169]],
                     (2, 0, 8, 20): [[313], [328], [319], [272], [171], [131], [390]],
                     (1, 0, 8, 0): [[127], [118], [115], [132], [97], [79], [136]],
                     (3, 1, 18, 20): [[342], [325], [338], [370], [350], [379], [333]],
                     (1, 0, 9, 0): [[127], [118], [115], [132], [97], [79], [136]],
                     (3, 0, 8, 20): [[494], [483], [430], [472], [293], [231], [574]],
                     (3, 1, 17, 40): [[342], [325], [338], [370], [350], [379], [333]],
                     (3, 1, 9, 40): [[274], [263], [248], [251], [171], [173], [335]],
                     (2, 0, 18, 40): [[261], [238], [278], [347], [277], [268], [295]],
                     (1, 0, 17, 0): [[190], [165], [161], [247], [209], [241], [169]],
                     (2, 0, 18, 20): [[261], [238], [278], [347], [277], [268], [295]],
                     (1, 1, 8, 20): [[339], [325], [325], [308], [223], [185], [377]],
                     (1, 0, 18, 0): [[190], [165], [161], [247], [209], [241], [169]]}
    Y_validation2 = {(1, 1, 9, 20): [[108], [92], [106], [132], [80], [105], [116]],
                     (2, 0, 9, 20): [[90], [100], [108], [93], [80], [67], [101]],
                     (3, 1, 17, 0): [[78], [69], [81], [92], [62], [80], [80]],
                     (3, 0, 17, 20): [[98], [105], [106], [118], [114], [124], [107]],
                     (3, 1, 17, 20): [[75], [75], [84], [83], [68], [81], [97]],
                     (3, 1, 8, 40): [[136], [130], [134], [118], [96], [70], [164]],
                     (1, 1, 9, 0): [[86], [121], [118], [107], [87], [80], [128]],
                     (1, 1, 18, 20): [[84], [76], [69], [81], [46], [91], [84]],
                     (1, 1, 8, 0): [[93], [118], [106], [106], [79], [57], [137]],
                     (3, 1, 9, 20): [[136], [91], [110], [106], [84], [74], [113]],
                     (1, 1, 17, 0): [[93], [90], [89], [116], [74], [113], [108]],
                     (3, 0, 8, 40): [[125], [127], [143], [140], [108], [86], [169]],
                     (3, 0, 18, 40): [[51], [68], [58], [75], [58], [74], [49]],
                     (1, 0, 8, 20): [[41], [50], [49], [46], [52], [28], [47]],
                     (1, 1, 18, 0): [[73], [63], [69], [74], [47], [77], [69]],
                     (1, 1, 9, 40): [[113], [111], [115], [116], [100], [96], [88]],
                     (1, 1, 17, 20): [[72], [108], [99], [149], [104], [105], [112]],
                     (3, 0, 9, 40): [[127], [140], [117], [116], [111], [103], [110]],
                     (3, 0, 18, 0): [[94], [79], [82], [91], [78], [65], [75]],
                     (3, 0, 9, 20): [[130], [147], [132], [162], [116], [92], [160]],
                     (1, 0, 18, 20): [[23], [19], [16], [41], [23], [30], [18]],
                     (2, 0, 9, 0): [[94], [103], [125], [105], [74], [66], [113]],
                     (1, 1, 8, 40): [[121], [109], [114], [94], [86], [84], [135]],
                     (3, 0, 17, 0): [[109], [120], [129], [123], [97], [107], [133]],
                     (1, 1, 17, 40): [[134], [112], [113], [144], [88], [106], [134]],
                     (2, 0, 8, 0): [[120], [127], [104], [97], [80], [48], [122]],
                     (3, 0, 8, 0): [[198], [137], [163], [175], [112], [86], [164]],
                     (2, 0, 17, 0): [[69], [88], [77], [90], [68], [88], [74]],
                     (2, 0, 9, 40): [[74], [91], [72], [83], [84], [78], [79]],
                     (3, 0, 9, 0): [[176], [145], [138], [140], [136], [94], [145]],
                     (1, 0, 8, 40): [[49], [50], [62], [46], [39], [37], [50]],
                     (2, 0, 17, 20): [[55], [56], [57], [75], [48], [56], [60]],
                     (1, 1, 18, 40): [[39], [73], [71], [98], [54], [49], [69]],
                     (3, 1, 8, 20): [[101], [115], [120], [114], [61], [81], [122]],
                     (3, 1, 18, 0): [[73], [71], [54], [62], [56], [78], [91]],
                     (1, 0, 17, 40): [[23], [34], [35], [54], [30], [46], [29]],
                     (3, 0, 17, 40): [[88], [96], [87], [112], [81], [82], [110]],
                     (1, 0, 18, 40): [[15], [31], [17], [40], [14], [22], [13]],
                     (3, 1, 18, 40): [[68], [80], [66], [58], [77], [79], [74]],
                     (2, 0, 17, 40): [[67], [64], [66], [73], [48], [54], [61]],
                     (1, 0, 9, 40): [[46], [59], [44], [44], [41], [42], [58]],
                     (2, 0, 18, 0): [[59], [65], [46], [67], [41], [49], [53]],
                     (1, 0, 9, 20): [[39], [38], [50], [45], [55], [35], [48]],
                     (3, 1, 9, 0): [[120], [139], [117], [123], [81], [94], [152]],
                     (2, 0, 8, 40): [[116], [114], [106], [104], [96], [57], [108]],
                     (3, 0, 18, 20): [[66], [68], [74], [77], [71], [80], [62]],
                     (3, 1, 8, 0): [[119], [115], [87], [102], [69], [61], [174]],
                     (1, 0, 17, 20): [[42], [29], [45], [40], [48], [37], [39]],
                     (2, 0, 8, 20): [[130], [128], [121], [117], [76], [61], [122]],
                     (1, 0, 8, 0): [[50], [48], [50], [37], [35], [30], [49]],
                     (3, 1, 18, 20): [[65], [77], [78], [73], [55], [88], [94]],
                     (1, 0, 9, 0): [[61], [42], [38], [38], [57], [45], [52]],
                     (3, 0, 8, 20): [[153], [152], [158], [152], [123], [87], [179]],
                     (3, 1, 17, 40): [[86], [87], [80], [70], [65], [76], [80]],
                     (3, 1, 9, 40): [[99], [98], [89], [101], [79], [87], [109]],
                     (2, 0, 18, 40): [[46], [56], [43], [54], [30], [50], [37]],
                     (1, 0, 17, 0): [[40], [32], [38], [56], [49], [43], [32]],
                     (2, 0, 18, 20): [[53], [54], [35], [67], [39], [45], [45]],
                     (1, 1, 8, 20): [[134], [111], [100], [107], [89], [68], [151]],
                     (1, 0, 18, 0): [[27], [27], [27], [38], [27], [44], [15]]}
    key = (1, 1, 9, 20)
    X = X_training1[key]
    y = Y_training1[key]
    N = len(X)
    X = np.array(X).reshape(N, 1)
    y = np.array(y).reshape(N)
    import sklearn.linear_model as skl
    lr = skl.LinearRegression()
    lr.fit(X, y)
    lr_results = lr.predict(X)

    regressor = MAPELinearRegression()
    # regressor.fit(X, y, lr.coef_, lr.intercept_)
    regressor.fit(X, y)
    results = regressor.predict(X)

    print("linear regression")
    print("w", lr.coef_)
    print("b", lr.intercept_)
    print("MAPE", np.sum(np.abs(lr_results-y)/y)/N)
    print("RMSE", np.sqrt(np.dot(lr_results-y, lr_results-y)/N))

    print("min-MAPE")
    print("w", regressor.coef_)
    print("b", regressor.intercept_)
    print("MAPE", np.sum(np.abs(results-y)/y)/N)
    print("RMSE", np.sqrt(np.dot(results-y, results-y)/N))

    print(np.array([y, results, lr_results]))


if __name__ == "__main__":
    test_real()

'''
final loss: 0.13913448862
linear regression
w [ 0.18040921]
b 50.6695500962
MAPE 0.142991603729
RMSE 18.6764837646
min-MAPE
w [[ 0.09970058]]
b 73.6006391698
MAPE 0.13913448862
RMSE 19.2567127372
'''